@inject Microsoft.AspNetCore.Http.IHttpContextAccessor httpContextAccessor;
@using Microsoft.AspNetCore.Http;
@using Bakdelar.Classes;
@using Bakdelar.MethodClasses;
@using System.Text.Json;
@using System.Text.Json.Serialization;
@{ 
    var shoppingBasket = httpContextAccessor.HttpContext.Session.GetBasket();
}
<div class="btn-group dropleft">
    <button class="btn btn-secondary dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        <span class="material-icons" id="dropdown_basket">
            shopping_basket
        </span>
        @{
            if (shoppingBasket == null || shoppingBasket.Count == 0)
            {
                @Html.Raw("0");
            }
            else
            {
                @Html.Raw($"{shoppingBasket.Sum(item => item.ItemCount)}");
                @*@Html.Raw($"{shoppingBasket.Count}");*@
            }

        }
    </button>

    <div class="dropdown-menu">
        <a href="@Url.Content("~/ShoppingBasket")"><h6 class="dropdown-header">Varukorg</h6></a>
        <div class="dropdown-divider"></div>
        <div class="container-fluid">
            @{
                if (shoppingBasket == null || !shoppingBasket.Any())
                {
                    <a class="dropdown-item" href="#">Tomt!</a>
                }
                else
                {


                    if (shoppingBasket == null || !shoppingBasket.Any())
                    {
                        <a class="dropdown-item" href="#">Tomt!</a>
                    }
                    else
                    {

                        decimal totalPrice = 0;
                        foreach (var item in shoppingBasket)
                        {



                            totalPrice += item.Price * item.ItemCount;
                            decimal priceForItems = item.Price * item.ItemCount;
                            //decimal priceForItems = item.Price * item.ItemCount;
                            <div class="flex-row d-flex flex-nowrap">
                                <a class="dropdown-item" href="@Url.Content($"~/SingleProductView/{item.ID}")">
                                    <img src="@item.ImageLink" style="width: 25px; height:25px;" />

                                    <div class="col-6 d-inline-block">
                                        @item.ProductName x @item.ItemCount
                                    </div>
                                    <div class="col-5 d-inline-block border-left ml-0 mr-5 px-1 border-dark">
                                        <span class="">á pris @item.Price kr : @priceForItems kr</span>


                                    </div>
                                    @*<div class="col-4 d-inline-block border-left px-1 border-dark">
                                        <span class="">Totalt: @priceForItems kr</span>
                                    </div>*@
                                </a>

                                <div class="dropdown-divider"></div>
                            </div>
                        }


                        <div class="dropdown-divider"></div>
                        <h6 class="dropdown-header text-center">Totalt: @totalPrice kr</h6>
                    }
                }
            }
        </div>

        @*<div class="dropdown-divider"></div>
        <a class="dropdown-item" href="Checkout">Till kassan</a>*@
    </div>
</div>

                   